const{Client:Client,Message:Message,MessageEmbed:MessageEmbed}=require("discord.js-selfbot"),{send:send}=require("../../Utility/functions");module.exports={name:"play",description:"Plays Music!",run:async(e,t,a)=>{try{const i=(new MessageEmbed).setColor(e.color).setFooter(`Made by ${e.owner.tag}`,e.owner.displayAvatarURL({dynamic:!0})),{guild:n}=t,s=t.member.voice?.channel;let r=e.manager.players.get(n.id);if(!r){if(!s)return i.setDescription("Not Connected To VC!"),await send(t,i,e);r=e.manager.create({guild:n.id,voiceChannel:s.id,textChannel:t.channel.id,selfDeafen:!1}),r.connect()}const c=a.join(" ");i.setDescription("Searching Song...");const u=await send(t,i,e);let o;try{o=await r.search(c,t.author),o.loadType}catch(a){return i.setDescription(`Unable To Find Song - ${c}`),await send(t,i,e)}switch(e.manager.on("trackStart",(async(e,t)=>{let a=Math.floor(t.duration/1e3/60<<0),n=Math.floor(t.duration/1e3%60);i.setThumbnail(`https://img.youtube.com/vi/${e.queue.current.identifier}/hqdefault.jpg`).setTitle(t.title).setURL(t.uri).setDescription(`Duration - **${a}:${n<10?`0${n}`:n}**\n\nRequested By ${t.requester.toString()}`),await u.edit(i).catch((()=>{}))})),o.loadType){case"NO_MATCHES":return r.queue.current||r.twentyFourSeven||r.destroy(),i.setDescription(`Unable To Find Song - ${c}`),await u.edit(i).catch((()=>{}));case"TRACK_LOADED":if(await r.queue.add(o.tracks[0]),r.playing||r.paused||r.queue.length||r.play(),i.setTitle("Queued").setDescription(`[${o.tracks[0].title}](${o.tracks[0].uri})`),r.queue.length>=1)return await u.edit(i).catch((()=>{}));case"PLAYLIST_LOADED":if(await r.queue.add(o.tracks),r.playing||r.paused||r.queue.size+1!==o.tracks.length||r.play(),i.setTitle("Queued").setDescription(`**${o.playlist.name}** \`[${o.tracks.length} Songs]\``),r.queue.length>=o.tracks.length)return await u.edit(i).catch((()=>{}));case"SEARCH_RESULT":if(await r.queue.add(o.tracks[0]),r.playing||r.paused||r.queue.length||r.play(),i.setTitle("Queued").setDescription(`[${o.tracks[0].title}](${o.tracks[0].uri})`),r.queue.length>=1)return await u.edit(i).catch((()=>{}))}}catch(e){throw new Error(e)}}};